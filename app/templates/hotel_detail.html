{% extends "base.html" %}

{% block title %}{{ hotel.name }}{% endblock %}

{% block styles %}
<style>
    /* Главное фото отеля */
    .hotel-hero {
        height: 400px;
        object-fit: cover;
        width: 100%;
        border-radius: var(--btn-radius);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    /* Карточка номера */
    .room-card {
        border: 1px solid var(--border);
        border-radius: var(--btn-radius);
        transition: all var(--transition-time);
        height: 100%;
        background: white;
    }

    .room-card:hover {
        border-color: var(--orange);
        transform: translateY(-3px);
        box-shadow: 0 12px 30px rgba(255, 109, 0, 0.12);
    }

    .room-img {
        height: 180px;
        object-fit: cover;
        width: 100%;
        border-top-left-radius: var(--btn-radius);
        border-top-right-radius: var(--btn-radius);
    }

    /* Бейджи удобств */
    .amenity-badge {
        background: var(--gray-light);
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.8rem;
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
        display: inline-block;
        color: var(--dark);
    }

    /* Цена в номере */
    .room-price {
        color: var(--orange);
        font-size: 1.5rem;
        font-weight: 700;
    }

    /* Заголовок секции */
    .section-title {
        padding-bottom: 0.75rem;
        margin-bottom: 1.5rem;
        border-bottom: 2px solid var(--border);
        color: var(--dark);
    }

    /* Мета информация отеля */
    .hotel-meta {
        display: flex;
        gap: 1rem;
        align-items: center;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
    }

    .meta-badge {
        background: rgba(255, 109, 0, 0.1);
        color: var(--orange);
        padding: 0.4rem 1rem;
        border-radius: 20px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Карточка информации */
    .info-card {
        border: 1px solid var(--border);
        border-radius: var(--btn-radius);
        background: white;
    }

    .info-header {
        background: var(--gray-light);
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--border);
        border-top-left-radius: var(--btn-radius);
        border-top-right-radius: var(--btn-radius);
    }

    .info-body {
        padding: 1.5rem;
    }

    .info-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1.25rem;
    }

    .info-item:last-child {
        margin-bottom: 0;
    }

    .info-icon {
        background: var(--orange);
        color: white;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        flex-shrink: 0;
    }

    .info-content {
        flex: 1;
    }

    .info-title {
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 0.25rem;
    }

    /* Кнопки действий */
    .action-buttons {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    /* Адаптивность */
    @media (max-width: 992px) {
        .hotel-hero {
            height: 350px;
        }
    }

    @media (max-width: 768px) {
        .hotel-hero {
            height: 300px;
        }

        .hotel-meta {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .room-img {
            height: 160px;
        }
    }
</style>
{% endblock %}

{% block content %}
{% include './components/header.html' %}

<main class="container py-4">
    <!-- Хлебные крошки -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Главная</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('main.catalog') }}">Каталог</a></li>
            <li class="breadcrumb-item active">{{ hotel.name|truncate(30) }}</li>
        </ol>
    </nav>

    <!-- Заголовок и фото -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-6 fw-bold mb-3">{{ hotel.name }}</h1>

            <!-- Мета информация -->
            <div class="hotel-meta">
                <span class="meta-badge">
                    <i class="bi bi-geo-alt"></i>{{ hotel.city }}
                </span>

                {% if hotel.phone %}
                <span class="meta-badge">
                    <i class="bi bi-telephone"></i>{{ hotel.phone }}
                </span>
                {% endif %}

                <span class="meta-badge">
                    <i class="bi bi-door-closed"></i>{{ rooms|length }} номеров
                </span>

                {% if hotel.email %}
                <span class="meta-badge">
                    <i class="bi bi-envelope"></i>{{ hotel.email }}
                </span>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Основная информация -->
        <div class="col-lg-8">
            <!-- Фото отеля -->
            <div class="mb-4">
                <img src="{{ url_for('static', filename='img/hotel.webp') }}" alt="{{ hotel.name }}" class="hotel-hero">
            </div>

            <!-- Описание отеля -->
            {% if hotel.description %}
            <div class="card mb-5">
                <div class="card-body">
                    <h2 class="h5 fw-bold mb-3">Описание отеля</h2>
                    <p class="card-text">{{ hotel.description }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Номера -->
            <div class="mb-4">
                <h2 class="section-title h4">Доступные номера</h2>

                {% if rooms %}
                <div class="row g-4">
                    {% for room in rooms %}
                    <div class="col-md-6">
                        <div class="room-card">
                            <!-- Фото номера -->
                            <div class="position-relative">
                                {% if room.image_url %}
                                <img src="{{ room.image_url }}" class="room-img" alt="{{ room.name }}">
                                {% else %}
                                <div class="room-img bg-light d-flex align-items-center justify-content-center">
                                    <i class="bi bi-image text-muted" style="font-size: 2.5rem;"></i>
                                </div>
                                {% endif %}
                            </div>

                            <!-- Информация о номере -->
                            <div class="p-3">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h3 class="h5 fw-bold mb-0">{{ room.name }}</h3>
                                    <span class="badge bg-primary">
                                        <i class="bi bi-people me-1"></i>{{ room.capacity }}
                                    </span>
                                </div>

                                {% if room.description %}
                                <p class="text-muted small mb-3">
                                    {{ room.description|truncate(90) }}
                                </p>
                                {% endif %}

                                <!-- Удобства -->
                                {% if room.amenities %}
                                <div class="mb-3">
                                    <div class="d-flex flex-wrap">
                                        {% for amenity in room.amenities.split(',')[:3] %}
                                        <span class="amenity-badge">{{ amenity.strip() }}</span>
                                        {% endfor %}
                                        {% if room.amenities.split(',')|length > 3 %}
                                        <span class="amenity-badge">+{{ room.amenities.split(',')|length - 3 }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Цена -->
                                <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
                                    <div>
                                        <div class="room-price">{{ room.price_per_night }} ₽</div>
                                        <p class="text-muted small mb-0">за ночь</p>
                                    </div>
                                    <a href="{{ url_for('main.book_room', hotel_id=hotel.id, room_id=room.id) }}"
                                        class="btn btn-primary btn-sm">
                                        <i class="bi bi-calendar-check me-1"></i>Забронировать
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="card">
                    <div class="card-body text-center py-5">
                        <i class="bi bi-door-closed display-5 text-muted mb-3"></i>
                        <h4 class="h5 mb-3">В этом отеле пока нет номеров</h4>
                        <p class="text-muted mb-0">
                            Обратитесь к администрации отеля для уточнения информации
                        </p>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Боковая панель -->
        <div class="col-lg-4">
            <!-- Карточка контактов -->
            <div class="info-card mb-4">
                <div class="info-header">
                    <h3 class="h5 mb-0">Контактная информация</h3>
                </div>
                <div class="info-body">
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="bi bi-geo-alt"></i>
                        </div>
                        <div class="info-content">
                            <div class="info-title">Адрес</div>
                            <p class="mb-0 text-muted small">{{ hotel.address }}, {{ hotel.city }}</p>
                        </div>
                    </div>

                    {% if hotel.phone %}
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="bi bi-telephone"></i>
                        </div>
                        <div class="info-content">
                            <div class="info-title">Телефон</div>
                            <a href="tel:{{ hotel.phone }}" class="text-muted small">{{ hotel.phone }}</a>
                        </div>
                    </div>
                    {% endif %}

                    {% if hotel.email %}
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="bi bi-envelope"></i>
                        </div>
                        <div class="info-content">
                            <div class="info-title">Email</div>
                            <a href="mailto:{{ hotel.email }}" class="text-muted small">{{ hotel.email }}</a>
                        </div>
                    </div>
                    {% endif %}

                    <div class="info-item">
                        <div class="info-icon">
                            <i class="bi bi-info-circle"></i>
                        </div>
                        <div class="info-content">
                            <div class="info-title">Статус</div>
                            <p class="mb-0 text-muted small">
                                {% if rooms %}
                                Открыт, доступно {{ rooms|length }} номеров
                                {% else %}
                                Информация уточняется
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Карточка действий -->
            <div class="info-card">
                <div class="info-header">
                    <h3 class="h5 mb-0">Действия</h3>
                </div>
                <div class="info-body">
                    <div class="action-buttons">
                        <a href="{{ url_for('main.catalog') }}" class="btn btn-outline-primary">
                            <i class="bi bi-arrow-left me-2"></i>Вернуться к каталогу
                        </a>

                        {% if current_user.is_authenticated and current_user.is_hotel_owner and hotel.owner_id ==
                        current_user.id %}
                        <a href="{{ url_for('user.hotel_rooms', hotel_id=hotel.id) }}"
                            class="btn btn-outline-secondary">
                            <i class="bi bi-gear me-2"></i>Управление номерами
                        </a>
                        {% endif %}

                        {% if rooms and current_user.is_authenticated and not current_user.is_hotel_owner %}
                        <button type="button" class="btn btn-outline-success" data-bs-toggle="modal"
                            data-bs-target="#contactModal">
                            <i class="bi bi-question-circle me-2"></i>Задать вопрос
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

{% include './components/footer.html' %}

<!-- Модальное окно для вопросов -->
{% if rooms and current_user.is_authenticated and not current_user.is_hotel_owner %}
<div class="modal fade" id="contactModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Задать вопрос отелю</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted small mb-3">
                    Ваш вопрос будет отправлен администрации отеля <strong>{{ hotel.name }}</strong>
                </p>
                <div class="mb-3">
                    <label class="form-label">Ваш вопрос</label>
                    <textarea class="form-control" rows="4" placeholder="Напишите ваш вопрос здесь..."></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Контактный email</label>
                    <input type="email" class="form-control" value="{{ current_user.email }}" readonly>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                <button type="button" class="btn btn-primary">Отправить вопрос</button>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    // Скрипт для модального окна вопросов
    document.addEventListener('DOMContentLoaded', function () {
        const contactModal = document.getElementById('contactModal');
        if (contactModal) {
            contactModal.addEventListener('shown.bs.modal', function () {
                const textarea = this.querySelector('textarea');
                textarea.focus();
            });
        }

        // Подсчет средней цены за номер (если нужно)
        const roomPrices = document.querySelectorAll('.room-price');
        if (roomPrices.length > 0) {
            let total = 0;
            roomPrices.forEach(price => {
                const priceText = price.textContent.replace(' ₽', '').replace(/\s/g, '');
                total += parseInt(priceText);
            });
            const avgPrice = Math.round(total / roomPrices.length);
            console.log('Средняя цена за номер:', avgPrice, '₽');
        }
    });
</script>
{% endblock %}